{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="mb-0">Picklist for Order #{{ order.reference }}</h2>
    <a class="btn btn-outline-secondary" href="{% url 'orders:order_picklist_pdf' order.id %}" target="_blank">ðŸ“„ Download PDF</a>
  </div>

  <div class="mb-3">
    <p class="mb-1"><strong>Customer:</strong> {{ order.full_name|default:"Guest" }}</p>
    <p class="mb-1"><strong>Email:</strong> {{ order.email|default:"â€”" }}</p>
    <p class="mb-1"><strong>Status:</strong> {{ order.get_status_display }}</p>
  </div>

  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col" class="text-center">Qty</th>
          <th scope="col">Product</th>
          <th scope="col" class="text-center">Grind</th>
          <th scope="col" class="text-center">Weight (g)</th>
          <th scope="col" class="text-end">Unit â‚¬</th>
          <th scope="col" class="text-end">Line â‚¬</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        {% for item in order.items.all %}
        <tr>
          <td class="text-center">{{ item.quantity }}</td>
          <td>{{ item.product_name_snapshot }}</td>
          <td class="text-center">{{ item.grind|default:"-" }}</td>
          <td class="text-center">{{ item.weight_grams }}</td>
          <td class="text-end">â‚¬{{ item.unit_price|floatformat:2 }}</td>
          <td class="text-end">â‚¬{{ item.line_total|floatformat:2 }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="text-center text-muted">No items on this order.</td></tr>
        {% endfor %}
      </tbody>
      <tfoot class="table-light">
        <tr>
          <th class="text-center">{{ total_qty }}</th>
          <th colspan="2">Totals</th>
          <th class="text-center">{{ total_weight }}</th>
          <th></th>
          <th class="text-end">â‚¬{{ grand_total|floatformat:2 }}</th>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{% url 'admin:orders_order_change' order.id %}" target="_blank">Open in Admin</a>
    <a class="btn btn-primary" href="{% url 'orders:order_picklist_pdf' order.id %}" target="_blank">Print PDF</a>
  </div>
</div>
{% endblock %}
